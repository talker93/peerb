import{f as y}from"./vendor.9fc0322d.js";const R=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function n(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?a.credentials="include":e.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(e){if(e.ep)return;e.ep=!0;const a=n(e);fetch(e.href,a)}};R();const A={apiKey:"AIzaSyB7Jkv647eebeqifG6mAHv40fUyfdDRB8k",authDomain:"fireship-demos-ce28a.firebaseapp.com",projectId:"fireship-demos-ce28a",storageBucket:"fireship-demos-ce28a.appspot.com",messagingSenderId:"710932691797",appId:"1:710932691797:web:705cbe6c90d03947af4ddc",measurementId:"G-VDYSM5CHE6"};y.apps.length||y.initializeApp(A);const C=y.firestore(),V={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},i=new RTCPeerConnection(V);let d=null,r=null,k=null;const B=document.getElementById("webcamButton"),u=document.getElementById("webcamVideo"),w=document.getElementById("callButton"),D=document.getElementById("callInput"),b=document.getElementById("answerButton"),M=document.getElementById("remoteVideo"),j=document.getElementById("hangupButton"),h=document.getElementById("testMode"),N=document.getElementById("remoteVideo"),g=document.querySelector("select#audioSource"),f=document.querySelector("select#audioOutput"),p=document.querySelector("select#videoSource"),S=[g,f,p];f.disabled=!("sinkId"in HTMLMediaElement.prototype);function $(t){const o=S.map(n=>n.value);S.forEach(n=>{for(;n.firstChild;)n.removeChild(n.firstChild)});for(let n=0;n!==t.length;++n){const c=t[n],e=document.createElement("option");e.value=c.deviceId,c.kind==="audioinput"?(e.text=c.label||`microphone ${g.length+1}`,g.appendChild(e)):c.kind==="audiooutput"?(e.text=c.label||`speaker ${f.length+1}`,f.appendChild(e)):c.kind==="videoinput"?(e.text=c.label||`camera ${p.length+1}`,p.appendChild(e)):console.log("Some other kind of source/device: ",c)}S.forEach((n,c)=>{Array.prototype.slice.call(n.childNodes).some(e=>e.value===o[c])&&(n.value=o[c])})}navigator.mediaDevices.enumerateDevices().then($).catch(x);function q(t,o){typeof t.sinkId!="undefined"?t.setSinkId(o).then(()=>{console.log(`Success, audio output device attached: ${o}`)}).catch(n=>{let c=n;n.name==="SecurityError"&&(c=`You need to use HTTPS for selecting audio output device: ${n}`),console.error(c),f.selectedIndex=0}):console.warn("Browser does not support output device selection.")}function P(){const t=f.value;q(N,t)}function x(t){console.log("navigator.MediaDevices.getUserMedia error: ",t.message,t.name)}function E(){const t=g.value;return p.value,{audio:{deviceId:t?{exact:t}:void 0},video:!1}}var m;g.addEventListener("change",function(){m=E()});g.addEventListener("change",function(){console.log(m)});f.onchange=P;p.addEventListener("change",function(){m=E()});p.addEventListener("change",function(){console.log(m)});m=E();B.onclick=async()=>{d=await navigator.mediaDevices.getUserMedia(m),r=new MediaStream,d.getTracks().forEach(o=>{i.addTrack(o,d)}),i.ontrack=o=>{o.streams[0].getTracks().forEach(n=>{r.addTrack(n)}),console.log("localStream getTracks"),console.log(d.getTracks()),console.log("remoteStream getTracks"),console.log(r.getTracks())},document.getElementById("muteMonitor").checked==!0?(u.autoplay=!0,u.muted=!0):u.muted=!1,u.srcObject=d,M.srcObject=r,w.disabled=!1,b.disabled=!1,B.disabled=!0};webcamButton2.onclick=async()=>{d=await navigator.mediaDevices.getUserMedia(m),r=new MediaStream,i.ontrack=t=>{t.streams[0].getTracks().forEach(o=>{r.addTrack(o)}),r.getTracks().forEach(o=>{k=i.addTrack(o,d)}),console.log("localStream getTracks"),console.log(d.getTracks()),console.log("remoteStream getTracks"),console.log(r.getTracks())},u.srcObject=d,M.srcObject=r,w.disabled=!1,b.disabled=!1,webcamButton2.disabled=!0,h.disabled=!1};const L=document.getElementById("muteMonitor");L.addEventListener("change",function(){L.checked==!0?(u.autoplay=!0,u.muted=!0,console.log("monitor muted")):(u.muted=!1,console.log("monitor unmuted"))});const I=document.getElementById("muteMe");I.checked=!1;I.addEventListener("change",function(){I.checked==!0?(d.getTracks()[0].enabled=!1,console.log("muted me")):(d.getTracks()[0].enabled=!0,console.log("unmuted me"))});h.disabled=!0;h.addEventListener("change",function(){h.value=="On"?(console.log("on"),k.replaceTrack(r.getTracks()[0])):h.value=="Off"&&(console.log("off"),k.replaceTrack(d.getTracks()[0]))});w.onclick=async()=>{const t=C.collection("calls").doc(),o=t.collection("offerCandidates"),n=t.collection("answerCandidates");D.value=t.id,i.onicecandidate=a=>{a.candidate&&o.add(a.candidate.toJSON())};const c=await i.createOffer();await i.setLocalDescription(c),console.log("offerdescription from pa"),console.log(c);const e={sdp:c.sdp,type:c.type};await t.set({offer:e}),console.log("offer from pa"),console.log(e),t.onSnapshot(a=>{const s=a.data();if(!i.currentRemoteDescription&&(s==null?void 0:s.answer)){const l=new RTCSessionDescription(s.answer);i.setRemoteDescription(l),console.log("answerdescription from pa"),console.log(l)}}),n.onSnapshot(a=>{a.docChanges().forEach(s=>{if(s.type==="added"){const l=new RTCIceCandidate(s.doc.data());i.addIceCandidate(l),console.log("candidate from pa"),console.log(l)}})}),j.disabled=!1};b.onclick=async()=>{const t=D.value,o=C.collection("calls").doc(t),n=o.collection("answerCandidates"),c=o.collection("offerCandidates");i.onicecandidate=v=>{v.candidate&&n.add(v.candidate.toJSON())};const e=(await o.get()).data();console.log(e);const a=e.offer;await i.setRemoteDescription(new RTCSessionDescription(a));const s=await i.createAnswer();await i.setLocalDescription(s),console.log("answerdescription from pb"),console.log(s);const l={type:s.type,sdp:s.sdp};await o.update({answer:l}),console.log("answer from pb"),console.log(l),c.onSnapshot(v=>{v.docChanges().forEach(T=>{if(T.type==="added"){let O=T.doc.data();i.addIceCandidate(new RTCIceCandidate(O))}})})};
